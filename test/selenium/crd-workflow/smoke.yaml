kind: TestWorkflow
apiVersion: testworkflows.testkube.io/v1
metadata:
  name: selenium-java-workflow-smoke
  labels:
    core-tests: workflows
    tool: selenium
    artifacts: "true"
    junit: "true"
description: "Selenium Java + Standalone Chrome"
spec:
  content:
    git:
      uri: https://github.com/kubeshop/testkube
      revision: TKC-4043-selenium-initial-cases
      paths:
      - test/selenium/selenium-java
  container:
    image: maven:3.9.11-eclipse-temurin-17
    workingDir: /data/repo/test/selenium/selenium-java
  services:
    chrome:
      image: selenium/standalone-chrome:112.0-chromedriver-112.0-grid-4.34.0-20250727
      timeout: 120s # initialization timeout
      logs: 'always'
      resources:
        requests:
          cpu: 128m
          memory: 128Mi
      readinessProbe:
        httpGet:
          path: /wd/hub/status
          port: 4444
        periodSeconds: 1
  steps:
    - name: Run test
      run:
        env:
          - name: REMOTE_WEBDRIVER_URL
            value: 'http://{{ services.chrome.0.ip }}:4444/wd/hub'
          - name: BROWSER
            value: 'chrome'
        shell: |
          mvn test
          mvn surefire-report:report
      artifacts:
        paths:
          - target/site/**/*
          - target/surefire-reports/**/*