---
# Test 1: failFast aborts remaining workers on first failure
# Worker 1 fails at 2s, others should abort promptly (total time << 30s)
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: fail-fast-parallel-basic
spec:
  steps:
  - parallel:
      failFast: true
      count: 4
      run:
        shell: |
          if [ "{{ index }}" = "1" ]; then sleep 2 && exit 1; fi
          sleep 30
---
# Test 2: failFast=false (default) waits for all workers
# All workers should complete regardless of failures
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: fail-fast-parallel-disabled
spec:
  steps:
  - parallel:
      count: 3
      run:
        shell: |
          if [ "{{ index }}" = "0" ]; then exit 1; fi
          sleep 5
---
# Test 3: failFast with parallelism throttling
# Only 2 workers run at a time; queued workers should be skipped on failure
apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: fail-fast-parallel-with-parallelism
spec:
  steps:
  - parallel:
      failFast: true
      parallelism: 2
      count: 6
      run:
        shell: |
          if [ "{{ index }}" = "0" ]; then sleep 1 && exit 1; fi
          sleep 30
